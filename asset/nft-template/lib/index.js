/* eslint-disable max-len */
/**
 * @fileOverview Utility functions to create NFT svg
 *
 * @module @arcblock/nft-template
 */
const AssetRecipient = require('@arcblock/asset-factory');
const pako = require('pako');
const { toBase64 } = require('@arcblock/forge-util');
/*
 * @param {object} params.data - asset payload
 * @param {string} params.data.name - certificate name
 * @param {string} params.data.description - certificate description
 * @param {string} params.data.reason - certificate reason
 * @param {string} params.data.logoUrl - certificate logo
 * @param {AssetRecipient} params.data.recipient - certificate recipient
 */
function createCertSvg({ data }) {
  const requiredFields = ['name', 'description', 'reason', 'recipient'];
  requiredFields.forEach(x => {
    if (!data[x]) {
      throw new Error(`Missing required field ${x} when creating  cert display`);
    }
  });

  if (!(data.recipient instanceof AssetRecipient)) {
    throw new Error('Invalid recipient field when creating cert svg');
  }

  return `<svg width="1122px" height="390px" viewBox="0 0 374 130" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <desc>
    ${data.name}
  </desc>
  <rect x="3" y="3" rx="10" ry="10" width="368" height="124" stroke="#2f3036" fill="#2f3036" stroke-width="2"/>
  <rect x="5" y="5" rx="10" ry="10" width="360" height="120" stroke="#a58c8b" fill="transparent" stroke-width="1"/>
  <text x="187" y="25" text-anchor="middle" font-size="12" fill="white"  >
    CERTIFICATE OF EXCELLENCE
  </text>
  <line x1="147" x2="227" y1="32" y2="32" stroke="#a58c8b" />
  <text x="187" y="45" text-anchor="middle" font-size="8" fill="white"  >
    Awarded to
  </text>
    <text x="187" y="65" text-anchor="middle" font-size="20" fill="white"  >
    ${data.recipient.name}
  </text>
    <text x="187" y="95" text-anchor="middle" font-size="12" fill="white"  >
    ${data.reason}
  </text>

  <g transform="translate(20,90)">
    <defs>
      <clipPath id="clip2">
        <path d="M 24 0 C 26.210938 0 28 1.789063 28 4 L 28 16 C 28 18.210938 26.210938 20 24 20 L 4 20 C 1.789063 20 0 18.210938 0 16 L 0 4 C 0 1.789063 1.789063 0 4 0 Z M 23.609375 2 L 4.390625 2 C 3.734375 2 3.175781 2.230469 2.710938 2.6875 C 2.246094 3.144531 2.011719 3.703125 2 4.359375 L 2.984375 4.359375 C 2.984375 3.972656 3.121094 3.644531 3.398438 3.367188 C 3.675781 3.089844 4.003906 2.953125 4.390625 2.953125 L 23.59375 2.953125 L 23.769531 2.960938 C 24.089844 2.996094 24.363281 3.128906 24.601563 3.367188 C 24.878906 3.644531 25.015625 3.972656 25.015625 4.359375 L 25.015625 13.5625 L 2 13.5625 L 2 15.65625 C 2.011719 16.3125 2.246094 16.867188 2.710938 17.320313 C 3.175781 17.773438 3.734375 18 4.390625 18 L 23.59375 18 L 23.824219 17.992188 C 24.390625 17.945313 24.878906 17.71875 25.289063 17.3125 C 25.753906 16.855469 25.988281 16.296875 26 15.640625 L 26 4.359375 C 25.988281 3.703125 25.753906 3.144531 25.289063 2.6875 C 24.824219 2.230469 24.265625 2 23.609375 2 Z M 17.109375 14 L 18.609375 17.359375 L 17.765625 17.34375 L 17.46875 16.625 L 16.125 16.625 L 15.84375 17.34375 L 15.015625 17.34375 L 16.5 14 Z M 19.171875 14 L 20.578125 14 L 20.6875 14.007813 L 20.921875 14.03125 L 20.890625 14.03125 C 20.972656 14.042969 21.050781 14.058594 21.117188 14.078125 C 21.183594 14.097656 21.25 14.125 21.3125 14.15625 L 21.296875 14.15625 C 21.359375 14.1875 21.414063 14.222656 21.460938 14.265625 C 21.507813 14.308594 21.550781 14.355469 21.59375 14.40625 C 21.625 14.46875 21.652344 14.535156 21.671875 14.601563 C 21.691406 14.667969 21.703125 14.738281 21.703125 14.8125 L 21.699219 14.957031 C 21.691406 15.011719 21.679688 15.0625 21.664063 15.109375 C 21.636719 15.183594 21.597656 15.25 21.546875 15.3125 L 21.5625 15.3125 C 21.5 15.375 21.433594 15.429688 21.359375 15.476563 C 21.285156 15.523438 21.207031 15.558594 21.125 15.578125 L 21.109375 15.578125 C 21.171875 15.589844 21.230469 15.601563 21.28125 15.617188 C 21.332031 15.632813 21.378906 15.652344 21.421875 15.671875 C 21.464844 15.691406 21.503906 15.71875 21.546875 15.75 C 21.589844 15.78125 21.625 15.8125 21.65625 15.84375 C 21.6875 15.875 21.714844 15.910156 21.742188 15.953125 C 21.769531 15.996094 21.792969 16.042969 21.8125 16.09375 L 21.84375 16.234375 C 21.855469 16.285156 21.859375 16.339844 21.859375 16.390625 L 21.851563 16.5625 L 21.828125 16.664063 C 21.808594 16.730469 21.78125 16.796875 21.75 16.859375 L 21.765625 16.859375 C 21.722656 16.910156 21.675781 16.960938 21.625 17.007813 L 21.46875 17.140625 C 21.40625 17.171875 21.339844 17.199219 21.273438 17.226563 C 21.207031 17.253906 21.136719 17.277344 21.0625 17.296875 L 21.046875 17.296875 L 20.835938 17.328125 C 20.757813 17.339844 20.683594 17.34375 20.609375 17.34375 L 19.171875 17.34375 Z M 25.015625 14 L 25.03125 14.625 L 24.046875 14.625 L 24.046875 17.34375 L 23.28125 17.34375 L 23.28125 14.640625 L 22.3125 14.640625 L 22.3125 14 Z M 20.703125 15.96875 L 19.921875 15.96875 L 19.921875 16.734375 L 20.78125 16.734375 L 20.867188 16.703125 C 20.894531 16.691406 20.921875 16.675781 20.953125 16.65625 L 20.984375 16.636719 L 21.015625 16.609375 C 21.035156 16.589844 21.050781 16.566406 21.0625 16.546875 L 21.0625 16.53125 C 21.082031 16.511719 21.097656 16.488281 21.101563 16.460938 C 21.105469 16.433594 21.109375 16.40625 21.109375 16.375 L 21.105469 16.289063 L 21.09375 16.242188 L 21.023438 16.113281 L 20.992188 16.078125 L 20.90625 16.015625 L 20.890625 16.015625 L 20.804688 15.984375 C 20.769531 15.972656 20.734375 15.96875 20.703125 15.96875 Z M 16.78125 14.953125 L 16.375 16 L 17.203125 16 Z M 20.640625 14.625 L 19.921875 14.625 L 19.921875 15.328125 L 20.484375 15.328125 C 20.515625 15.328125 20.546875 15.324219 20.578125 15.320313 L 20.625 15.3125 L 20.671875 15.3125 C 20.691406 15.300781 20.71875 15.292969 20.75 15.28125 L 20.828125 15.25 L 20.882813 15.195313 C 20.898438 15.179688 20.910156 15.15625 20.921875 15.125 C 20.941406 15.105469 20.957031 15.082031 20.960938 15.054688 C 20.964844 15.027344 20.96875 15 20.96875 14.96875 L 20.960938 14.859375 C 20.957031 14.828125 20.941406 14.800781 20.921875 14.78125 L 20.902344 14.75 L 20.875 14.726563 C 20.855469 14.710938 20.832031 14.699219 20.8125 14.6875 L 20.796875 14.6875 C 20.777344 14.667969 20.753906 14.652344 20.726563 14.640625 C 20.699219 14.628906 20.671875 14.625 20.640625 14.625 Z M 19.921875 10.890625 C 19.808594 10.890625 19.699219 10.910156 19.601563 10.953125 C 19.503906 10.996094 19.410156 11.046875 19.328125 11.109375 C 19.253906 11.183594 19.195313 11.269531 19.148438 11.367188 C 19.101563 11.464844 19.078125 11.574219 19.078125 11.6875 C 19.078125 11.738281 19.085938 11.789063 19.101563 11.835938 L 19.15625 11.984375 C 19.175781 12.027344 19.203125 12.066406 19.234375 12.109375 C 19.265625 12.152344 19.296875 12.1875 19.328125 12.21875 C 19.371094 12.261719 19.410156 12.292969 19.453125 12.320313 C 19.496094 12.347656 19.542969 12.371094 19.59375 12.390625 L 19.578125 12.390625 C 19.628906 12.410156 19.683594 12.425781 19.742188 12.4375 C 19.800781 12.449219 19.855469 12.453125 19.90625 12.453125 L 20.035156 12.445313 C 20.105469 12.4375 20.175781 12.417969 20.242188 12.390625 C 20.339844 12.347656 20.425781 12.292969 20.5 12.21875 L 20.578125 12.148438 C 20.621094 12.101563 20.660156 12.042969 20.6875 11.976563 C 20.730469 11.878906 20.753906 11.777344 20.765625 11.671875 L 20.757813 11.554688 C 20.746094 11.488281 20.726563 11.421875 20.695313 11.359375 C 20.648438 11.265625 20.582031 11.183594 20.5 11.109375 C 20.425781 11.046875 20.339844 10.996094 20.242188 10.953125 C 20.144531 10.910156 20.035156 10.890625 19.921875 10.890625 Z M 4.9375 5.15625 L 2 5.15625 L 2 12.390625 L 4.75 12.390625 C 5 12.390625 5.238281 12.371094 5.46875 12.335938 C 5.699219 12.300781 5.917969 12.246094 6.125 12.171875 L 6.140625 12.171875 C 6.371094 12.097656 6.589844 12.003906 6.796875 11.890625 C 7.003906 11.777344 7.199219 11.652344 7.375 11.515625 L 7.390625 11.5 C 7.777344 11.199219 8.085938 10.816406 8.320313 10.359375 C 8.554688 9.902344 8.671875 9.40625 8.671875 8.875 L 8.671875 8.6875 C 8.671875 8.40625 8.644531 8.136719 8.59375 7.882813 C 8.542969 7.628906 8.464844 7.390625 8.359375 7.171875 L 8.34375 7.15625 C 8.25 6.9375 8.132813 6.734375 7.992188 6.546875 C 7.851563 6.359375 7.699219 6.191406 7.53125 6.046875 C 7.355469 5.902344 7.167969 5.769531 6.96875 5.65625 C 6.769531 5.542969 6.558594 5.449219 6.328125 5.375 L 6.359375 5.375 C 6.128906 5.300781 5.898438 5.246094 5.664063 5.210938 C 5.429688 5.175781 5.1875 5.15625 4.9375 5.15625 Z M 10.703125 5.15625 L 9.375 5.15625 L 9.375 12.390625 L 10.703125 12.390625 Z M 14.703125 5.15625 L 11.78125 5.15625 L 11.78125 12.390625 L 14.53125 12.390625 C 14.78125 12.390625 15.019531 12.371094 15.25 12.335938 C 15.480469 12.300781 15.691406 12.246094 15.890625 12.171875 L 15.921875 12.171875 C 16.152344 12.097656 16.371094 12.003906 16.578125 11.890625 C 16.785156 11.777344 16.980469 11.652344 17.15625 11.515625 L 17.171875 11.5 C 17.359375 11.355469 17.527344 11.1875 17.679688 11 C 17.832031 10.8125 17.96875 10.609375 18.09375 10.390625 L 18.078125 10.40625 C 18.191406 10.175781 18.285156 9.933594 18.351563 9.671875 C 18.417969 9.410156 18.453125 9.140625 18.453125 8.859375 L 18.453125 8.6875 C 18.453125 8.40625 18.425781 8.136719 18.367188 7.882813 C 18.308594 7.628906 18.234375 7.390625 18.140625 7.171875 L 18.125 7.15625 C 18.03125 6.9375 17.914063 6.734375 17.773438 6.546875 C 17.632813 6.359375 17.472656 6.191406 17.296875 6.046875 L 17.3125 6.046875 C 17.136719 5.902344 16.949219 5.769531 16.75 5.65625 C 16.550781 5.542969 16.339844 5.449219 16.109375 5.375 L 16.140625 5.375 C 15.910156 5.300781 15.675781 5.246094 15.4375 5.210938 C 15.199219 5.175781 14.953125 5.15625 14.703125 5.15625 Z M 4.5 6.3125 L 4.8125 6.320313 L 5.09375 6.34375 C 5.28125 6.363281 5.457031 6.394531 5.625 6.4375 L 5.640625 6.453125 C 5.796875 6.496094 5.949219 6.550781 6.09375 6.625 C 6.238281 6.699219 6.375 6.785156 6.5 6.890625 L 6.515625 6.890625 C 6.628906 6.984375 6.738281 7.09375 6.835938 7.21875 C 6.933594 7.34375 7.015625 7.484375 7.078125 7.640625 L 7.078125 7.625 C 7.152344 7.78125 7.207031 7.949219 7.242188 8.125 C 7.277344 8.300781 7.296875 8.488281 7.296875 8.6875 L 7.296875 8.84375 C 7.296875 9.03125 7.277344 9.214844 7.234375 9.390625 C 7.191406 9.566406 7.136719 9.734375 7.0625 9.890625 L 7.0625 9.90625 C 6.980469 10.050781 6.886719 10.1875 6.78125 10.3125 C 6.675781 10.4375 6.558594 10.550781 6.421875 10.65625 L 6.421875 10.640625 C 6.285156 10.746094 6.136719 10.832031 5.976563 10.90625 C 5.816406 10.980469 5.644531 11.042969 5.46875 11.09375 L 5.5 11.09375 C 5.300781 11.136719 5.105469 11.167969 4.90625 11.195313 C 4.707031 11.222656 4.511719 11.234375 4.3125 11.234375 L 3.328125 11.234375 L 3.328125 6.3125 Z M 14.296875 6.3125 L 14.507813 6.316406 C 14.636719 6.320313 14.761719 6.328125 14.882813 6.34375 C 15.066406 6.363281 15.238281 6.394531 15.40625 6.4375 L 15.421875 6.453125 C 15.589844 6.496094 15.746094 6.550781 15.890625 6.625 C 16.035156 6.699219 16.171875 6.785156 16.296875 6.890625 C 16.421875 6.984375 16.53125 7.09375 16.625 7.21875 C 16.71875 7.34375 16.796875 7.484375 16.859375 7.640625 L 16.859375 7.625 C 16.921875 7.78125 16.972656 7.949219 17.015625 8.132813 C 17.058594 8.316406 17.078125 8.5 17.078125 8.6875 L 17.078125 8.828125 C 17.078125 9.027344 17.058594 9.214844 17.015625 9.390625 C 16.972656 9.566406 16.910156 9.734375 16.828125 9.890625 L 16.828125 9.90625 C 16.753906 10.050781 16.664063 10.1875 16.554688 10.3125 C 16.445313 10.4375 16.328125 10.550781 16.203125 10.65625 L 16.203125 10.640625 C 16.066406 10.746094 15.917969 10.832031 15.757813 10.90625 C 15.597656 10.980469 15.421875 11.042969 15.234375 11.09375 L 15.28125 11.09375 C 15.082031 11.136719 14.886719 11.167969 14.6875 11.195313 C 14.488281 11.222656 14.285156 11.234375 14.078125 11.234375 L 13.109375 11.234375 L 13.109375 6.3125 Z M 19.9375 7.40625 L 19.792969 7.414063 C 19.722656 7.425781 19.652344 7.445313 19.585938 7.476563 C 19.488281 7.523438 19.402344 7.582031 19.328125 7.65625 C 19.253906 7.71875 19.195313 7.800781 19.148438 7.898438 C 19.101563 7.996094 19.078125 8.105469 19.078125 8.21875 C 19.078125 8.28125 19.085938 8.335938 19.101563 8.382813 C 19.117188 8.429688 19.136719 8.472656 19.15625 8.515625 L 19.15625 8.53125 C 19.175781 8.574219 19.203125 8.613281 19.234375 8.65625 C 19.265625 8.699219 19.300781 8.734375 19.34375 8.765625 L 19.394531 8.8125 L 19.460938 8.851563 C 19.507813 8.878906 19.558594 8.902344 19.609375 8.921875 L 19.59375 8.921875 C 19.644531 8.941406 19.699219 8.957031 19.75 8.96875 C 19.800781 8.980469 19.859375 8.984375 19.921875 8.984375 L 20.050781 8.976563 C 20.121094 8.96875 20.191406 8.949219 20.257813 8.921875 C 20.355469 8.878906 20.441406 8.824219 20.515625 8.75 C 20.589844 8.6875 20.648438 8.605469 20.695313 8.507813 C 20.742188 8.410156 20.765625 8.300781 20.765625 8.1875 C 20.765625 8.074219 20.742188 7.96875 20.695313 7.875 C 20.648438 7.78125 20.582031 7.703125 20.5 7.640625 L 20.421875 7.574219 C 20.367188 7.53125 20.308594 7.496094 20.242188 7.46875 C 20.144531 7.425781 20.042969 7.40625 19.9375 7.40625 Z M 19.9375 7.40625 "/>
      </clipPath>
      <clipPath id="clip1">
        <rect width="28" height="20"/>
      </clipPath>
      <g id="surface4" clip-path="url(#clip1)">
        <g clip-path="url(#clip2)" clip-rule="evenodd">
          <rect x="0" y="0" width="28" height="20" style="fill:#bcbcbc;fill-opacity:1;stroke:none"/>
        </g>
      </g>
    </defs>
    <g id="surface1">
      <use xlink:href="#surface4"/>
    </g>
   
  </g>
</svg>
  `;
}

const createSvgDisplay = (svg, text) => `<svg
  width="374px"
  height="130px"
  viewBox="0 0 374 130"
  version="1.1"
  xmlns="http://www.w3.org/2000/svg"
  xmlnsXlink="http://www.w3.org/1999/xlink">
  <desc>Created with arcblock.io</desc>
  ${svg}
  ${insertText({ x: 50, y: 100, size: 20, anchor: 'left', color: 'black', text })}
</svg>`;

/**
 * inset a text in svg
 * @param {object} param
 * @param {int}  param.x position.x of the text
 * @param {int}  param.y position.y of the text
 * @param {int}  param.size font size of the text
 * @param {string}  param.anchor Text alignment: left right middle
 * @param {string} param.color color of text
 * @param {string} param.text text
 */
const insertText = ({ x, y, size, anchor, color, text }) =>
  `<text x="${x}" y="${y}" font-size="${size}' text-anchor="${anchor}" fill="${color}" >${text} </text>`;

const createZippedSvgDisplay = svg => toBase64(pako.gzip(svg));

module.exports = {
  createCertSvg,
  createZippedSvgDisplay,
  insertText,
  createSvgDisplay,
};
