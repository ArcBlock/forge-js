# 红包应用

## 应用的类型

- Bare App：红包应用依赖某个链运行，而没有自己的链，红包应用的数据则存储在自己的关系型数据库里面，优势是可以运行在任何链上面，缺点是除了交易，数据都不在链上；
- Chain App：红包应用有自己的链，所有的数据存储在 account_state 里面，优势是数据都在链上，但是在多链之间去交互会有比较大的问题，也是目前 forge 尚未解决的问题

## 基本业务规则

- 未领取的红包可以退回，但创建红包时是否需要冻结用户在某条链上的资产？
- 已领取的红包表示 Tx 已经广播给网络，还是交易已经被确认？

## Bare App 的用户基本流程

流程中涉及的参与方：用户（ArcWallet）、红包应用（App）、某条应用链（Chain）

### 浏览数据

- 用户在钱包里面扫码打开红包应用界面（DID Auth 的过程），可以查看自己发出去的，收到的红包
  - 针对发出去的红包，可以查看红包的领取人列表、数量
  - 针对收到的红包，可以查看发送人等信息

### 创建红包

- 用户点击“创建红包”，红包应用请求 Wallet 授权访问用户在哪些链上的哪些资产，用户选择授权或者拒绝，授权即选择要发送什么资产的过程
- 红包应用收到用户的授权信息（appId、chainInfo），获取余额信息
- 用户在红包应用内填写红包基本信息，如类别、总金额、分成几个，创建红包领取 Tx（包含多个待签名的交易）
- 红包应用请求用户签名多个交易，Wallet 把签名后的交易提交给红包应用
- 红包创建完毕之后，用户会收到红包领取地址，每次发送都不同，可以分享给朋友（建议朋友拿 ArcWallet 打开）

### 领取红包

- 领取红包的用户需要先下载 ArcWallet，打开红包领取页面
- 红包应用在待领取的红包 Tx 中随机选择一个，然后请求 ArcWallet 签名，签名提示是领取红包
- 签名之后，直接把交易发送到特定的链上，然后提示用户红包领取中（如果 Tx 失败怎么处理？）
